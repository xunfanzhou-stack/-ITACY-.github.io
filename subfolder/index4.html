<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新加坡PSI实时数据</title>
    <style>
        /* CSS样式：简单排版表格，确保可读性 */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 30px; color: #333; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f5f5f5; font-weight: bold; }
        tr:nth-child(even) { background-color: #fafafa; }
        .error { color: red; text-align: center; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>新加坡PSI实时数据（12项读数）</h1>
    <!-- 表格容器：用于展示API返回的12项读数 -->
    <table id="psiTable">
        <thead>
            <tr>
                <<th>读数类型</</th>
                <<th>西区（west）</</th>
                <<th>东区（east）</</th>
                <<th>中区（central）</</th>
                <<th>南区（south）</</th>
                <<th>北区（north）</</th>
            </tr>
        </thead>
        <tbody id="psiTableBody"></tbody>
    </table>

    <script>
        // JS逻辑：连接API、提取12项读数、渲染表格
        const apiUrl = "https://api.data.gov.sg/v1/environment/psi";
        const tableBody = document.getElementById("psiTableBody");

        // 定义需展示的12项读数（按要求从o3_sub_index到psi_twenty_four_hourly）
        const targetReadings = [
            "o3_sub_index", "pm10_twenty_four_hourly", "pm10_sub_index", 
            "co_sub_index", "pm25_twenty_four_hourly", "so2_sub_index", 
            "co_eight_hour_max", "no2_one_hour_max", "so2_twenty_four_hourly", 
            "pm25_sub_index", "psi_twenty_four_hourly", "o3_eight_hour_max"
        ];

        // 发起API请求并处理数据
        fetch(apiUrl)
            .then(response => {
                if (!response.ok) throw new Error("API请求失败，请检查网络或稍后重试");
                return response.json();
            })
            .then(data => {
                // 提取最新的读数数据（items数组第一个元素为最新数据）
                const latestReadings = data.items[0].readings;
                
                // 遍历12项读数，生成表格行
                targetReadings.forEach(readingType => {
                    const row = document.createElement("tr");
                    // 第一列：读数类型（美化格式，如o3_sub_index→O3子指数）
                    const typeCell = document.createElement("td");
                    typeCell.textContent = formatReadingName(readingType);
                    row.appendChild(typeCell);

                    // 后续列：各区域的读数数值
                    const regions = ["west", "east", "central", "south", "north"];
                    regions.forEach(region => {
                        const valueCell = document.createElement("td");
                        valueCell.textContent = latestReadings[readingType][region] || "无数据";
                        row.appendChild(valueCell);
                    });

                    tableBody.appendChild(row);
                });
            })
            .catch(error => {
                // 错误处理：在表格中显示错误信息
                tableBody.innerHTML = `<tr><td colspan="6" class="error">${error.message}</td></tr>`;
                console.error("错误详情：", error);
            });

        // 辅助函数：美化读数类型名称（如pm25_sub_index→PM2.5子指数）
        function formatReadingName(name) {
            const map = {
                "o3_sub_index": "O3子指数",
                "pm10_twenty_four_hourly": "PM10 24小时浓度",
                "pm10_sub_index": "PM10子指数",
                "co_sub_index": "CO子指数",
                "pm25_twenty_four_hourly": "PM2.5 24小时浓度",
                "so2_sub_index": "SO2子指数",
                "co_eight_hour_max": "CO 8小时最大值",
                "no2_one_hour_max": "NO2 1小时最大值",
                "so2_twenty_four_hourly": "SO2 24小时浓度",
                "pm25_sub_index": "PM2.5子指数",
                "psi_twenty_four_hourly": "PSI 24小时指数",
                "o3_eight_hour_max": "O3 8小时最大值"
            };
            return map[name] || name;
        }
    </script>
</body>
</html>
